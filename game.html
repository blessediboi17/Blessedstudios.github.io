<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shadow Beats: Director Elite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; background: #050a14; overflow: hidden; font-family: 'Courier New', monospace; color: #64ffda; transition: background 1s; }
        canvas { display: block; touch-action: none; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; z-index: 10; }
        #rank { font-size: 14px; letter-spacing: 3px; color: #fff; margin-top: 5px; }
        #start-btn { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; background: #64ffda; color: #050a14; border: none;
            font-weight: bold; font-size: 20px; border-radius: 5px; cursor: pointer; z-index: 20; box-shadow: 0 0 20px #64ffda;
        }
        .action-text { position: absolute; top: 40%; width: 100%; text-align: center; font-size: 50px; opacity: 0; pointer-events: none; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <button id="start-btn">ðŸŽ¬ START DIRECTING</button>
    <div id="ui">
        <div style="letter-spacing: 5px; font-weight: bold;">SHADOW BEATS</div>
        <div id="score">SCORE: 0</div>
        <div id="rank">RANK: JUNIOR EDITOR</div>
    </div>
    <div id="action" class="action-text">ACTION!</div>
    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start-btn');
    const actionText = document.getElementById('action');
    const rankText = document.getElementById('rank');
    
    let score = 0;
    let items = [];
    let gameStarted = false;
    let pulse = 0;
    let beatInterval = 800; // Starting speed (ms)
    let gameLoop;
    let level = 1;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playBeat() {
        if(!gameStarted) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        // Pitch goes up as level goes up
        osc.frequency.setValueAtTime(150 + (level * 20), audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
        
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
        
        pulse = 15; 
        spawnItem();

        // Recursively call for dynamic speed
        setTimeout(playBeat, beatInterval);
    }

    class FilmStrip {
        constructor() {
            this.x = Math.random() * (canvas.width - 100) + 50;
            this.y = canvas.height + 50;
            this.w = 45;
            this.h = 65;
            this.speedY = -10 - (level * 1.5); // Faster items each level
            this.gravity = 0.25;
            this.hue = 160; // Initial Cyan
        }
        draw() {
            ctx.strokeStyle = `hsl(${this.hue + (level*30)}, 100%, 70%)`;
            ctx.lineWidth = 3;
            ctx.strokeRect(this.x - this.w/2, this.y - this.h/2, this.w, this.h);
        }
    }

    function spawnItem() {
        items.push(new FilmStrip());
    }

    function checkLevelUp() {
        if (score >= level * 500) {
            level++;
            beatInterval = Math.max(300, beatInterval - 100); // Speed up music
            
            // Update UI
            if (level === 2) { rankText.innerText = "RANK: HEAD DIRECTOR"; document.body.style.background = "#1a0505"; }
            if (level === 3) { rankText.innerText = "RANK: CINEMATIC MASTER"; document.body.style.background = "#1a1505"; }
            if (level >= 4) { rankText.innerText = "RANK: EXECUTIVE PRODUCER"; }
            
            actionText.innerText = "LEVEL UP!";
            actionText.style.opacity = "1";
            setTimeout(() => actionText.style.opacity = "0", 1000);
        }
    }

    function handleInput(ex, ey) {
        items.forEach((item, i) => {
            if (Math.abs(item.x - ex) < 45 && Math.abs(item.y - ey) < 45) {
                items.splice(i, 1);
                score += 100;
                document.getElementById('score').innerText = "SCORE: " + score;
                checkLevelUp();
            }
        });
    }

    startBtn.onclick = () => {
        gameStarted = true;
        startBtn.style.display = 'none';
        playBeat();
        animate();
    };

    window.addEventListener('mousemove', (e) => handleInput(e.clientX, e.clientY));
    window.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleInput(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive: false});

    function animate() {
        let bg = level === 1 ? '5, 10, 20' : (level === 2 ? '26, 5, 5' : '26, 21, 5');
        ctx.fillStyle = `rgba(${bg}, ${pulse > 0 ? 0.3 : 0.1})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if(pulse > 0) pulse--;

        items.forEach((item, i) => {
            item.y += item.speedY;
            item.speedY += item.gravity;
            item.draw();
            if(item.y > canvas.height + 100) items.splice(i, 1);
        });

        requestAnimationFrame(animate);
    }
</script>
</body>
            </html>
