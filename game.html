<!DOCTYPE html>
<html>
<head>
    <title>Blessed Tiles | Pro Edition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; background: #050a14; overflow: hidden; font-family: 'Segoe UI', sans-serif; transition: background 0.1s; }
        canvas { display: block; touch-action: none; }
        #ui { position: absolute; top: 15px; width: 100%; text-align: center; color: #64ffda; font-size: 32px; pointer-events: none; z-index: 10; font-weight: 900; letter-spacing: 2px; }
        #overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; color: white; z-index: 20;
        }
        button { padding: 18px 50px; font-size: 22px; background: #64ffda; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; color: #050a14; box-shadow: 0 0 20px #64ffda; }
    </style>
</head>
<body>

    <div id="ui">SCORE: <span id="score">0</span></div>

    <div id="overlay">
        <h1 id="msg" style="color:#64ffda; font-size: 45px; margin-bottom: 10px;">BLESSED TILES</h1>
        <p id="final" style="font-size: 20px; margin-bottom: 30px;"></p>
        <button onclick="startGame()">START GAME</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreText = document.getElementById('score');
    const overlay = document.getElementById('overlay');
    const msg = document.getElementById('msg');
    const finalScore = document.getElementById('final');

    let score = 0;
    let tiles = [];
    let gameActive = false;
    let speed = 5;
    let spawnRate = 35; 
    let frameCount = 0;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const colW = canvas.width / 4;

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playNote(freq, type = 'triangle') {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.5);
    }

    class Tile {
        constructor(col) {
            this.col = col;
            this.w = colW;
            this.h = canvas.height / 3.5;
            this.x = col * colW;
            this.y = -this.h;
            this.active = true;
        }
        draw() {
            ctx.fillStyle = this.active ? "#64ffda" : "rgba(100, 255, 218, 0.1)";
            ctx.fillRect(this.x + 3, this.y + 3, this.w - 6, this.h - 6);
            if(this.active) {
                ctx.fillStyle = "rgba(0,0,0,0.2)";
                ctx.fillRect(this.x + 10, this.y + 10, 5, 15);
                ctx.fillRect(this.x + this.w - 15, this.y + 10, 5, 15);
            }
        }
    }

    function startGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        score = 0;
        tiles = [];
        speed = 5.5;
        spawnRate = 35;
        gameActive = true;
        overlay.style.display = 'none';
        scoreText.innerText = score;
        document.body.style.background = "#050a14";
        animate();
    }

    function gameOver() {
        gameActive = false;
        
        // --- VIBRATION & SOUND ON LOSS ---
        if (navigator.vibrate) navigator.vibrate([200, 100, 200]); 
        playNote(100, 'sawtooth'); // Low "buzz" sound for error
        
        document.body.style.background = "#ff4d4d"; // Red flash
        msg.innerText = "GAME OVER";
        finalScore.innerText = "Final Score: " + score;
        overlay.style.display = 'flex';
    }

    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleTap(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive: false});
    canvas.addEventListener('mousedown', (e) => handleTap(e.clientX, e.clientY));

    function handleTap(tx, ty) {
        if (!gameActive) return;
        let hit = false;
        
        tiles.forEach((tile) => {
            if (tx > tile.x && tx < tile.x + tile.w && ty > tile.y && ty < tile.y + tile.h && tile.active) {
                tile.active = false;
                score += 10;
                scoreText.innerText = score;
                
                // Play specific piano notes
                const notes = [261.63, 329.63, 392.00, 523.25]; // C, E, G, C
                playNote(notes[tile.col]);
                
                // Short vibrate for success
                if (navigator.vibrate) navigator.vibrate(20); 

                speed += 0.04; 
                hit = true;
            }
        });

        // If you tap a blank spot (mistake)
        if(!hit && ty < canvas.height) gameOver();
    }

    function animate() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw Grid
        ctx.strokeStyle = "rgba(100, 255, 218, 0.1)";
        for(let i=1; i<4; i++) {
            ctx.beginPath();
            ctx.moveTo(i * colW, 0); ctx.lineTo(i * colW, canvas.height);
            ctx.stroke();
        }

        frameCount++;
        if (frameCount % Math.floor(spawnRate) === 0) {
            tiles.push(new Tile(Math.floor(Math.random() * 4)));
            if (spawnRate > 18) spawnRate -= 0.05;
        }

        tiles.forEach((tile, i) => {
            tile.y += speed;
            tile.draw();
            if (tile.y > canvas.height && tile.active) gameOver();
            if (tile.y > canvas.height + 200) tiles.splice(i, 1);
        });

        requestAnimationFrame(animate);
    }
</script>
</body>
    </html>
